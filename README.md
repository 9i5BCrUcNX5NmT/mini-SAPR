# Оптимизированный САПР

## Инструкции по запуску

### Для разработки (с быстрой компиляцией):
```bash
cargo run --features dev
```

### Для релиза:
```bash
cargo run --release
```

### Дополнительные функции:
```bash
# С инспектором для отладки
cargo run --features "dev,inspector"

# С профайлером
cargo run --features "dev,profiler"
```

## Основные оптимизации

### 1. Cargo.toml оптимизации
- Включены оптимизации для зависимостей в dev режиме
- Добавлена функция `dev` с dynamic_linking для быстрой компиляции
- Настроены различные профили сборки
- Добавлены опциональные инструменты отладки

### 2. Системная архитектура
- Использование Change Detection для условного выполнения систем
- Ранние выходы из систем при отсутствии изменений
- Явное управление порядком систем с `.chain()`
- Параллельная обработка где возможно

### 3. Оптимизация запросов
- Использование `single_mut()` для единичных компонентов
- Разделение запросов для лучшего параллелизма
- Использование `With`/`Without` фильтров
- Применение `for_each` и `par_iter_mut` для производительности

### 4. Управление памятью
- Кэширование материалов и мешей
- Переиспользование ресурсов
- Пакетные операции для spawn/despawn
- Ленивое вычисление позиций камеры

### 5. Рендеринг оптимизации
- Эффективное переключение видимости без пересоздания
- Кэшированные материалы сетки
- Оптимизированная обработка освещения

## Горячие клавиши

- `C` - Переключение режима орбитальной камеры
- `R` - Сброс камеры в исходное положение
- `F1` - Переключение wireframe режима
- `F2` - Переключение освещения
- `F3` - Переключение теней
- `F4` - Переключение видимости сетки
- `F5` - Показать информацию о режимах рендеринга
- `F12` - Сохранить настройки рендеринга

## Профилирование

Для анализа производительности используйте:

```bash
# Cargo flamegraph (требует установки)
cargo install flamegraph
cargo flamegraph --bin cursovaia

# Bevy профайлер (с функцией profiler)
cargo run --features "dev,profiler"
```

## Дополнительные улучшения

### Для очень простых проектов:
Раскомментируйте строки в `main.rs` для отключения многопоточности в Update schedule.

### Для проектов с большим количеством объектов:
- Рассмотрите использование Instancing для повторяющихся объектов
- Используйте LOD (Level of Detail) системы
- Применяйте Frustum Culling для отсечения невидимых объектов

### Для проектов с частыми изменениями:
- Используйте Sparse Set storage для компонентов которые часто добавляются/удаляются
- Применяйте Events для связи между системами
- Рассмотрите использование Commands.queue() для отложенных операций